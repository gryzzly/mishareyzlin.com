!!! 5
%html(lang="en")
  %head
    %meta(charset="utf-8")
    - if @description
      %meta(name="description" content=@description)
    - if @keywords
      %meta(name="keywords" content=@keywords)
    %title
      - if @page.metadata('pagetitle')
        = @site_title + ' â€“ ' + @page.metadata('pagetitle')
      - elsif @page.heading
        = @site_title + ' - ' + @page.heading
      - else
        = @site_title
    <!--[if ! lte IE 6]><!-->
    %link(href="/mr/css/main.css" media="screen" rel="stylesheet")
    %link(href="/mr/css/print.css" media="print" rel="stylesheet")
    %script(src="http://use.typekit.com/grk3csh.js")
    :javascript
      try{Typekit.load();}catch(e){}
    <!--<![endif]-->
    /[if lte IE 6]
      %link(rel="stylesheet" href="http://universal-ie6-css.googlecode.com/files/ie6.1.1.css" media="screen, projection")
    /[if lt IE 9]
      %script(src="//html5shim.googlecode.com/svn/trunk/html5.js")
    = local_stylesheet_link_tag('local')
    %link(href="/articles.xml" rel="alternate" type="application/atom+xml")
    = haml :analytics, :layout => false
  -# get page class from page's metadata
  - page_class = @page.metadata('pageclass')
  - page_action = @page.metadata('pageaction')
  %body{:class => (page_class if page_class && !page_class.empty?),  
        :data => { :action => ( page_action if page_action && !page_action.empty? ) } }
    %header.header
      %a.logo(href="/")
        %span m
      = haml :nav, :layout => false, :locals => { :page => @page }
    %section.main
      = yield
      -# if this page has children, show summaries
      - if ( @page.metadata('summary') == 'true' )
        .main-notes 
          = article_summaries(latest_articles)
    - if (@page.path.include? 'notes')
      %aside.secondary
        %div.secondary-promotejs
          = promotejs()
    %script(src="http://code.jquery.com/jquery-1.5.2.min.js")
    %script(src="/mr/js/hashgrid.js")
    %script(src="/mr/js/main.js")